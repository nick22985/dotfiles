#!/usr/bin/env bash

set -e

script_dir="$( cd "$( dirname "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )"

echo "üßπ Cleaning git submodules..."

if [[ ! -f "$script_dir/.gitmodules" ]]; then
    echo "‚ùå No .gitmodules file found"
    exit 1
fi

while IFS= read -r line; do
    if [[ $line =~ ^[[:space:]]*path[[:space:]]*=[[:space:]]*(.+)$ ]]; then
        submodule_path="${BASH_REMATCH[1]}"
        full_path="$script_dir/$submodule_path"

        if [[ -d "$full_path" ]]; then
            echo "üóëÔ∏è  Removing: $submodule_path"
            rm -rf "$full_path"
        else
            echo "‚úì Already clean: $submodule_path"
        fi
    fi
done < "$script_dir/.gitmodules"

echo "‚úÖ All submodule directories removed"
