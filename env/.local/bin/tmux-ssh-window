#!/usr/bin/env bash
session_name=$1

# Get the latest window ID (the one that just got created)
win_id=$(tmux list-windows -t "$session_name" -F "#{window_id}" | tail -n1)
pane_start_command=$(tmux display-message -p -t "$session_name:$win_id" '#{pane_start_command}')

# If the new window is running tmux-sessionizer, don't do anything
if [[ "$pane_start_command" == *tmux-sessionizer* ]]; then
    exit 0
fi

ssh_host=$(tmux show-environment -t "$session_name" | grep '^TMUX_SSH_HOST=' | cut -d= -f2)

if [[ -n "$ssh_host" ]]; then
    # Replace its first pane with ssh
    tmux send-keys -t "$session_name:$win_id" "ssh $ssh_host" C-m
fi
